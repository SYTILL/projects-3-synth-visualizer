<!DOCTYPE html>
<html lang="en" dir="ltr">

<head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>WEB SYNTH</title>
    <link rel="stylesheet" href="styles.css">
    <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Anta">
</head>

<body>
    <div class="body-outer">
        <div class="separator top-body">
            <div class="body-inner logo">

            </div>
            <div class="body-inner select-control">

            </div>
            <div class="body-inner volume-control">

            </div>
        </div>
        <div class="separator mid-body">
            <div class="mid-extra">
                <div class="body-inner" id="ocs-sub">
                    <div class="title">
                        <input class="title-checkbox" type="checkbox" checked>
                        <span class="title-text">SUB</span>
                    </div>
                </div>
                <div class="body-inner" id="ocs-noise">
                    <div class="title">
                        <input class="title-checkbox" type="checkbox" checked>
                        <span class="title-text">NOISE</span>
                    </div>
                </div>
            </div>
            <div class="body-inner" id="osc-main" data-id="A">
                <div class="title">
                    <input class="title-checkbox" type="checkbox" checked>
                    <span class="title-text">OCS A</span>
                </div>
                <div class="wavetable-body">
                    <canvas class="wavetable" id="wavetable-canvas-A"></canvas>
                    <div class="wavetable-selection" id="wavetable-selection-A"></div>
                </div>
                <div class="knobs-row">

                </div>
                <div class="knobs-row">

                </div>
            </div>
            <div class="body-inner" id="osc-main" data-id="B">
                <div class="title">
                    <input class="title-checkbox" type="checkbox" checked>
                    <span class="title-text">OCS B</span>
                </div>
                <div class="wavetable-body">
                    <canvas class="wavetable" id="wavetable-canvas-B"></canvas>
                    <div class="wavetable-selection" id="wavetable-selection-B"></div>
                </div>
                <div class="knobs-row">

                </div>
                <div class="knobs-row">

                </div>
            </div>
            <div class="body-inner filter-body">
                <div class="title">
                    <input class="title-checkbox" type="checkbox" checked>
                    <span class="title-text">FILTER</span>
                </div>
            </div>
        </div>
        <div class="separator bot-body">
            <div class="body-inner ENV-body">

            </div>
            <div class="body-inner LFO-body">

            </div>
            <div class="body-inner bot-extra">

            </div>
        </div>

        <div class="piano-body">
            <div class="wrapper">
                <header>
                    <div class="column keys-checkbox">
                        <input type="checkbox" checked>
                        <span>Show Keys</span>
                    </div>
                </header>
                <ul class="piano-keys">
                    <li class="key white" data-key="a"><span>a</span></li>
                    <li class="key black" data-key="w"><span>w</span></li>
                    <li class="key white" data-key="s"><span>s</span></li>
                    <li class="key black" data-key="e"><span>e</span></li>
                    <li class="key white" data-key="d"><span>d</span></li>
                    <li class="key white" data-key="f"><span>f</span></li>
                    <li class="key black" data-key="t"><span>t</span></li>
                    <li class="key white" data-key="g"><span>g</span></li>
                    <li class="key black" data-key="y"><span>y</span></li>
                    <li class="key white" data-key="h"><span>h</span></li>
                    <li class="key black" data-key="u"><span>u</span></li>
                    <li class="key white" data-key="j"><span>j</span></li>
                    <li class="key white" data-key="k"><span>k</span></li>
                    <li class="key black" data-key="o"><span>o</span></li>
                    <li class="key white" data-key="l"><span>l</span></li>
                    <li class="key black" data-key="p"><span>p</span></li>
                    <li class="key white" data-key=";"><span>;</span></li>
                </ul>
            </div>
        </div>
    </div>







    <script src="https://cdnjs.cloudflare.com/ajax/libs/tone/14.8.37/Tone.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/audiokeys@0.1.1/dist/audiokeys.min.js"></script>


    <script>

        //-------------------#add wavetable images #images #wavetable------------------

        const waveTablesTypes = ['sine', 'triangle', 'sawtooth', 'square'];

        const createOSC = (selectionBody, canvasBody) => {
            return {
                body: document.getElementById(selectionBody),
                oscillator: new Tone.Oscillator(440, "sine"),
                canvas: document.getElementById(canvasBody),
            };
        };
        oscA = createOSC('wavetable-selection-A', 'wavetable-canvas-A');
        oscB = createOSC('wavetable-selection-B', 'wavetable-canvas-B');

        //------------#draw #canvas ----------------------------
        async function drawWaveform(oscBody) {
            oscillator = oscBody.oscillator;
            canvas = oscBody.canvas;
            ctx = canvas.getContext('2d');

            ctx.clearRect(0, 0, canvas.width, canvas.height);

            const waveform = await oscillator.asArray(1024);

            ctx.strokeStyle = 'blue';
            ctx.lineWidth = 2;
            ctx.beginPath();
            ctx.moveTo(0, canvas.height / 2);
            for (let i = 0; i < waveform.length; i++) {
                const x = (i / waveform.length) * canvas.width;
                const y = ((waveform[i] + 1) / 2) * canvas.height;
                ctx.lineTo(x, y);
            }
            ctx.stroke();
        }

        //-----------#disable all --------- if one wavetable is selected----------
        const selectWavetable = async (oscBody, selectedImg) => {
            const selectionBody = oscBody.body;
            const images = selectionBody.querySelectorAll('img');

            images.forEach(img => {
                img.style.margin = '1px';
                img.src = `src/images/${img.alt}-wave-off.png`;
                img.setAttribute('data-onoff', false);

            });

            selectedImg.style.margin = '0px';
            selectedImg.src = `src/images/${selectedImg.alt}-wave.png`;
            selectedImg.setAttribute('data-onoff', true);

            oscBody.oscillator.type = selectedImg.alt;
            await drawWaveform(oscBody);
        };

        //------------#create------------ wavetables in selection Body
        const addWavetablesSelection = async (oscBody) => {
            let first = true;
            waveTablesTypes.forEach(name => {
                const img = document.createElement('img');
                img.classList.add('wavetable-selection-presets');
                img.src = `src/images/${name}-off.png`;
                img.alt = name;
                img.setAttribute('data-onoff', false);

                img.addEventListener("click", () => {
                    selectWavetable(oscBody, img);
                });
                oscBody.body.appendChild(img);

                if (first === true) {
                    first = img;
                }
            });
            await selectWavetable(oscBody, first);
        };

        addWavetablesSelection(oscA);
        addWavetablesSelection(oscB);






        //tone
        const synth = new Tone.Synth().toDestination();
        const keyboard = new AudioKeys({ rows: 1 });

        keyboard.down((key) => {
            playSynth(key);
        });

        const playSynth = (key) => {
            const clickedKey = document.querySelector(`[data-key="${String.fromCharCode(key.keyCode).toLowerCase()}"]`);
            clickedKey.classList.add("active");
            setTimeout(() => {
                clickedKey.classList.remove("active");
            }, 150);
            synth.triggerAttackRelease(key.frequency, "8n");
        };





        //---------------piano visual-------------------
        const keysCheckbox = document.querySelector(".keys-checkbox input");
        const pianoKeys = document.querySelectorAll(".piano-keys .key");
        let allKeys = [];

        //[Show-Keys] checkbox function
        const showHideKeys = () => {
            pianoKeys.forEach(key => key.classList.toggle("hide"));
        }
        keysCheckbox.addEventListener("click", showHideKeys);

        //piano pressed effect - click
        pianoKeys.forEach(key => {
            allKeys.push(key.dataset.key);
            key.addEventListener("click", () => {
                keyboard._addKey({ keyCode: key.dataset.key.toUpperCase().charCodeAt(0) });
                keyboard._removeKey({ keyCode: key.dataset.key.toUpperCase().charCodeAt(0) });
            });
        });

    </script>
</body>

</html>